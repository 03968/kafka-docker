{"name":"Kafka Docker","tagline":"Run multiple Kafka brokers in Docker","body":"Following the excellent tutorials on how to run a multi broker kafka cluster natively:\r\n[http://www.michael-noll.com/blog/2013/03/13/running-a-multi-broker-apache-kafka-cluster-on-a-single-node/](http://www.michael-noll.com/blog/2013/03/13/running-a-multi-broker-apache-kafka-cluster-on-a-single-node/) and in vagrant: [http://allthingshadoop.com/2013/12/07/using-vagrant-to-get-up-and-running-with-apache-kafka/] (http://allthingshadoop.com/2013/12/07/using-vagrant-to-get-up-and-running-with-apache-kafka/)\r\n\r\nHere is the tutorial based on Docker:\r\n\r\n#Cluster Setup\r\n1. Install [Docker](https://www.docker.io/gettingstarted/#h_installation) \r\n\r\n```\r\n$ export START_SCRIPT=https://raw2.github.com/wurstmeister/kafka-docker/master/start-broker.sh\r\n$ curl -Ls $START_SCRIPT | bash /dev/stdin <id-1> <port-1> <host-ip>\r\n$ curl -Ls $START_SCRIPT | bash /dev/stdin <id-2> <port-2> <host-ip>\r\n$ ... \r\n```\r\n\r\ne.g. to start a cluster with two brokers on 192.168.178.28\r\n\r\n```\r\n$ curl -Ls $START_SCRIPT | bash /dev/stdin 1 9092 192.168.178.28\r\n$ curl -Ls $START_SCRIPT | bash /dev/stdin 2 9093 192.168.178.28\r\n```\r\n\r\nThis will start a single zookeeper instance on 192.168.178.28:49181, a kafka instance on 192.168.178.28:9092 and one on 192.168.178.28:9093.\r\n\r\n#Kafka Shell\r\nYou can interact with your kafka cluster via the kafka shell:\r\n\r\n```\r\n$ docker run -link zookeeper:zk -i -t wurstmeister/kafka /bin/bash\r\n```\r\n\r\n#Testing\r\nTo test your setup, start a shell, create a topic and start a producer:\r\n```\r\n$ $KAFKA_HOME/bin/kafka-topics.sh --create --topic topic \\\r\n--partitions 4 --zookeeper $ZK_PORT_2181_TCP_ADDR --replication-factor 2\r\n$ $KAFKA_HOME/bin/kafka-topics.sh --describe --topic topic \\\r\n--zookeeper $ZK_PORT_2181_TCP_ADDR \r\n$ $KAFKA_HOME/bin/kafka-console-producer.sh --topic=topic \\\r\n--broker-list=192.168.178.28:9092\r\n```\r\n\r\nStart another shell and start a consumer:\r\n\r\n```\r\n$ $KAFKA_HOME/bin/kafka-console-consumer.sh --topic=topic --zookeeper=$ZK_PORT_2181_TCP_ADDR \r\n```\r\n\r\n# Running docker within vagrant:\r\n\r\nIf you are running docker within vagrant, make sure you enable port forwarding:\r\n```\r\n$ FORWARD_DOCKER_PORTS='true' vagrant up\r\n```\r\nand set the <host-ip> to the IP of you docker host (i.e. you vagrant vm ip)\r\n\r\n# Troubleshooting:\r\n\r\n* By default a kafka broker uses 1GB of memory, so if you have trouble starting a broker, check ```docker logs``` for the container and make sure you've got enough memory available on your host.\r\n* Do not use localhost or 127.0.0.1 as the host ip if you want to run multiple brokers otherwise the brokers won't be able to communicate","google":"UA-47065224-1","note":"Don't delete this file! It's used internally to help with page regeneration."}