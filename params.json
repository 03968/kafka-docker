{"name":"Kafka Docker","tagline":"Run multiple Kafka brokers in Docker","body":"Following the excellent tutorials on how to run a multi broker kafka cluster natively:\r\n[http://www.michael-noll.com/blog/2013/03/13/running-a-multi-broker-apache-kafka-cluster-on-a-single-node/](http://www.michael-noll.com/blog/2013/03/13/running-a-multi-broker-apache-kafka-cluster-on-a-single-node/) and in vagrant: [http://allthingshadoop.com/2013/12/07/using-vagrant-to-get-up-and-running-with-apache-kafka/] (http://allthingshadoop.com/2013/12/07/using-vagrant-to-get-up-and-running-with-apache-kafka/)\r\n\r\nHere is the tutorial based on Docker and Fig:\r\n\r\n#Cluster Setup\r\n1. Install [Docker](https://www.docker.io/gettingstarted/#h_installation) \r\n2. Install [Fig](http://www.fig.sh/install.html)\r\n3. Update ```fig.yml``` with you docker host ip (```KAFKA_ADVERTISED_HOST_NAME```) \r\n4. If you want to customise any Kafka parameters, simply add them as environment variables in ```fig.yml```, e.g. in order to increase the ```message.max.bytes``` parameter set the environment to ```KAFKA_MESSAGE_MAX_BYTES: 2000000```. To turn off automatic topic creation set ```KAFKA_AUTO_CREATE_TOPICS_ENABLE: 'false'```\r\n5. Start the cluster\r\n\r\n```\r\n$ fig up\r\n```\r\n\r\ne.g. to start a cluster with two brokers\r\n\r\n```\r\n$ fig scale kafka=2\r\n```\r\n\r\nThis will start a single zookeeper instance and two kafka instances. You can use ```fig ps``` to inspect the running instances. If you want to add more kafka brokers simply increase the value passed to ```fig scale kafka=...```\r\n\r\n\r\n#Kafka Shell\r\nYou can interact with your kafka cluster via the kafka shell:\r\n\r\n```\r\n$ start-kafka-shell.sh <DOCKER_HOST_IP>\r\n```\r\n\r\n#Testing\r\nTo test your setup, start a shell, create a topic and start a producer:\r\n```\r\n$ $KAFKA_HOME/bin/kafka-topics.sh --create --topic topic \\\r\n--partitions 4 --zookeeper $ZK_PORT_2181_TCP_ADDR --replication-factor 2\r\n$ $KAFKA_HOME/bin/kafka-topics.sh --describe --topic topic \\\r\n--zookeeper $ZK_PORT_2181_TCP_ADDR \r\n$ $KAFKA_HOME/bin/kafka-console-producer.sh --topic=topic \\\r\n--broker-list=`broker-list.sh`\r\n```\r\n\r\nStart another shell and start a consumer:\r\n\r\n```\r\n$ $KAFKA_HOME/bin/kafka-console-consumer.sh --topic=topic \\\r\n--zookeeper=$ZK_PORT_2181_TCP_ADDR \r\n```\r\n\r\n# Running kafka-docker on a Mac:\r\n\r\nUse [Boot2Docker](http://boot2docker.io/)\r\n\r\n# Troubleshooting:\r\n\r\n* By default a kafka broker uses 1GB of memory, so if you have trouble starting a broker, check ```docker logs``` for the container and make sure you've got enough memory available on your host.\r\n* Do not use localhost or 127.0.0.1 as the host ip if you want to run multiple brokers otherwise the brokers won't be able to communicate","google":"UA-47065224-1","note":"Don't delete this file! It's used internally to help with page regeneration."}